#!/bin/bash

if [[ ${CONFIG_FILE_URL} ]];
then
    echo "Downloading... config file"
    curl -o config.env -s $CONFIG_FILE_URL
    echo "Done"
else
    echo "CONFIG_FILE_URL var not provided!"
fi

echo "from dotenv import load_dotenv
load_dotenv('config.env', override=True)" >> load_config.py
python3 load_config.py && rm load_config.py

if [[ ${UPSTREAM_REPO} && ${UPSTREAM_BRANCH} ]];
then
    echo "Detected UPSTREAM_REPO and UPSTREAM_BRANCH"
else
    UPSTREAM_REPO="https://github.com/ahad0xff/admlb"
    UPSTREAM_BRANCH="main"
    echo "UPSTREAM_REPO or UPSTREAM_BRANCH missing, using default ones"
fi

[ -d ".git" ] && rm -rf ".git"

git init -q
git config --global user.email ahadmirrorlab1@gmail.com
git config --global user.name ahadz-git
git add .
git commit -sm update -q
git remote add origin $UPSTREAM_REPO
git fetch origin -q
git reset --hard origin/$UPSTREAM_BRANCH -q

python3 -m bot
